# views.py

from django.db.models import Sum
from django.db.models.functions import TruncMonth
from django.http import JsonResponse
from .models import Expense

def monthly_expenses(request):
    # Query expenses, group by month, and calculate the total for each month
    expenses = (Expense.objects
                .annotate(month=TruncMonth('date'))
                .values('month')
                .annotate(total_amount=Sum('amount'))
                .order_by('month'))

    # Prepare the data for response
    data = {expense['month'].strftime('%Y-%m'): expense['total_amount'] for expense in expenses}
    
    return JsonResponse(data)